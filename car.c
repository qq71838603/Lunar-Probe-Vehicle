#include <stdlib.h>
#include <stdio.h>
#include <netdb.h>
#include <pthread.h>
#include <sys/types.h>
#include <sys/socket.h>
#include <string.h>
#include <netinet/in.h>
#include <arpa/inet.h>
#include <unistd.h>
#include <fcntl.h>

#define SERVPORT 4444

int flag=0;
int panduanxunwen;  
int zuobiaobaohu=1;
pthread_t transcommand;  
int sockfd; int 
sockfd_shoudong; 
int back_line,back_col,forward_line,forward_col;
int k,asd,bushu;
char dixin[180][15]={
{'*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ','!',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ','!',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*','*','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*','*','*','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*','*','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*','*','*','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ','*','*','*','*','*',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ','*',' ',' ','*',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ','*',' ',' ','*',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ','*',' ',' ','*',' ',' ',' ',' '},
{' ',' ','*',' ',' ',' ','*',' ',' ','*',' ',' ',' ',' ',' '},
{' ',' ','*',' ',' ','*',' ',' ',' ','*',' ',' ',' ',' ',' '},
{' ',' ','*',' ','*',' ',' ',' ','*',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '}

};

char dixinbackup[180][15]={
{'*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*','*','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*','*','*','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*','*','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*','*','*','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ','*','*','*','*','*',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ','*',' ',' ','*',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ','*',' ',' ','*',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ','*',' ',' ','*',' ',' ',' ',' '},
{' ',' ','*',' ',' ',' ','*',' ',' ','*',' ',' ',' ',' ',' '},
{' ',' ','*',' ',' ','*',' ',' ',' ','*',' ',' ',' ',' ',' '},
{' ',' ','*',' ','*',' ',' ',' ','*',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '},
{' ',' ',' ','*',' ',' ',' ',' ',' ',' ',' ',' ',' ',' ',' '}

};

void forward_one_step()
{
   
      if( (forward_line==80)&&(forward_col==7)&&(back_line==80)   )
    {  
   if(  (dixin[forward_line-1][forward_col]=='*')
     && (dixin[forward_line][forward_col+1]=='*')
     && (dixin[forward_line+1][forward_col]=='*') 
     ){
   dixin[back_line][back_col]='*';
   dixin[forward_line][forward_col+1]='!';
   back_line=forward_line;back_col=forward_col;
   forward_col=forward_col+1;
   return;
     }
    }

  if( (forward_line==80)&&(forward_col==7)&&(back_line==79)   )
   {
   if(  (dixin[forward_line][forward_col-1]=='*')
     && (dixin[forward_line+1][forward_col]=='*')
     && (dixin[forward_line][forward_col+1]=='*')
     ){
   dixin[back_line][back_col]='*';
   dixin[forward_line+1][forward_col]='!';
   back_line=forward_line;back_col=forward_col;
   forward_line=forward_line+1;
   return;

     }
    }
  
  //同一行，前面的列号大，向右
  if( (forward_line==back_line)&&(forward_col>back_col) )
   {
    if( (dixin[forward_line][forward_col+1]=='*')
     && (dixin[forward_line-1][forward_col+1]=='*')
     && (dixin[forward_line+1][forward_col+1]=='*')
      ){
   dixin[back_line][back_col]='*';
   dixin[forward_line][forward_col+1]='!';
   back_line=forward_line;back_col=forward_col;
   forward_col=forward_col+1;
   return;
       }
    }
  //向左
  if( (forward_line==back_line)&&(forward_col<back_col) )
   {
    if( (dixin[forward_line][forward_col-1]=='*')
     && (dixin[forward_line-1][forward_col-1]=='*')
     && (dixin[forward_line+1][forward_col-1]=='*')
      ){
   dixin[back_line][back_col]='*';
   dixin[forward_line][forward_col-1]='!';
   back_line=forward_line;back_col=forward_col;
   forward_col=forward_col-1;
   return;
       }
    }
  //列号相同，前面的行号大，向下
  if( (forward_col==back_col)&&(forward_line>back_line)  )
   {
    if( (dixin[forward_line+1][forward_col-1]=='*')
     && (dixin[forward_line+1][forward_col]=='*')
     && (dixin[forward_line+1][forward_col+1]=='*')
      ){
   dixin[back_line][back_col]='*';
   dixin[forward_line+1][forward_col]='!';
   back_line=forward_line;back_col=forward_col;
   forward_line=forward_line+1;
   return;
       }
   }
  //...................小，向上
  if( (forward_col==back_col)&&(forward_line<back_line)  )  
   {

    if( (dixin[forward_line-1][forward_col-1]=='*')
     && (dixin[forward_line-1][forward_col]=='*')
     && (dixin[forward_line-1][forward_col+1]=='*')
      ){
   dixin[back_line][back_col]='*';
   dixin[forward_line-1][forward_col]='!';
   back_line=forward_line;back_col=forward_col;
   forward_line=forward_line-1;
   return;
       }


   }
  

  if(dixin[forward_line][forward_col-1]=='*'){
   dixin[back_line][back_col]='*';
   dixin[forward_line][forward_col-1]='!';
   back_line=forward_line;back_col=forward_col;
   forward_col=forward_col-1;
   return;
  }
  if(dixin[forward_line][forward_col+1]=='*'){
   dixin[back_line][back_col]='*';
   dixin[forward_line][forward_col+1]='!';
   back_line=forward_line;back_col=forward_col;
   forward_col=forward_col+1;
   return;
  }

  if(dixin[forward_line+1][forward_col]=='*'){
   dixin[back_line][back_col]='*';
   dixin[forward_line+1][forward_col]='!';
   back_line=forward_line;back_col=forward_col;
   forward_line=forward_line+1;
   return;
  }


  if(dixin[forward_line+1][forward_col-1]=='*'){
   dixin[back_line][back_col]='*';
   dixin[forward_line+1][forward_col-1]='!';
   back_line=forward_line;back_col=forward_col;
   forward_line=forward_line+1;forward_col=forward_col-1;
   return;
  }
  if(dixin[forward_line+1][forward_col+1]=='*'){
   dixin[back_line][back_col]='*';
   dixin[forward_line+1][forward_col+1]='!';
   back_line=forward_line;back_col=forward_col;
   forward_line=forward_line+1;forward_col=forward_col+1;
   return;
  }

    if(dixin[forward_line-1][forward_col]=='*'){
   dixin[back_line][back_col]='*';
   dixin[forward_line-1][forward_col]='!';
   back_line=forward_line;back_col=forward_col;
   forward_line=forward_line-1;
   return;
  }

      if(dixin[forward_line-1][forward_col-1]=='*'){
   dixin[back_line][back_col]='*';
   dixin[forward_line-1][forward_col-1]='!';
   back_line=forward_line;back_col=forward_col;
   forward_line=forward_line-1;forward_col=forward_col-1;
   return;
  }

      if(dixin[forward_line-1][forward_col+1]=='*'){
   dixin[back_line][back_col]='*';
   dixin[forward_line-1][forward_col+1]='!';
   back_line=forward_line;back_col=forward_col;
   forward_line=forward_line-1;forward_col=forward_col+1;
   return;
  }


}

void screen_refresh()
{
    int asd,i,j;
    for(asd=1;asd<=60;asd++){printf("\n");
}
    printf("===========new frame===========\n");
    for(i=back_line-3;i<=back_line+19;i++)
     {
          for(j=0;j<=14;j++)
          {
                printf("%c ",dixin[i][j]);
          } //endfor j
      printf("\n");
      }//endfor i
}

void xunwenserver(void *arg){
  //panduanxunwen=1;     //信号量  互斥量
  char buf[256];
  struct sockaddr_in serv_addr;
  sockfd=socket(AF_INET,SOCK_STREAM,0);
  sockfd_shoudong=socket(AF_INET,SOCK_STREAM,0);

  bzero(&serv_addr,sizeof(struct sockaddr_in));
  serv_addr.sin_family=AF_INET;
  serv_addr.sin_port=htons(SERVPORT);
  inet_aton("127.0.0.1",&serv_addr.sin_addr);

  connect(sockfd,(struct sockaddr *)&serv_addr,sizeof(struct sockaddr));sleep(1);
  connect(sockfd_shoudong,(struct sockaddr *)&serv_addr,sizeof(struct sockaddr));sleep(1);
  while(1)
   {
  send(sockfd," a:  前进\n b:  停止\n c:  GPS\n d:  切成手动控制\n e:  结束控制\n f:  剩余步数\n",
   strlen(" a:  前进\n b:  停止\n c:  GPS\n d:  切成手动控>制\n e:  结束控制\n f:  剩余步数\n"),0); 
  memset(buf,0,256);
  recv(sockfd,buf,256,0);
  if( strcmp(buf,"d")==0 )
   { flag=0;
    while(1){
    send(sockfd_shoudong,"1:左\n2:左下\n3:下\n4:右下\n5:右\n6:右上\n7:上\n8:左上\n9:结束手动控制\n",
    strlen("1:左\n2:左下\n3:下\n4:右下\n5:右\n6:右上\n7:上\n8:左上\n9:结束手动控制\n"),0);
  memset(buf,0,256);
  recv(sockfd_shoudong,buf,256,0);
  if( strcmp(buf,"1")==0 ){
 dixin[back_line][back_col]=dixinbackup[back_line][back_col]; 
 dixin[forward_line][forward_col-1]='!';
 back_line=forward_line;back_col=forward_col;
 forward_col=forward_col-1;
     screen_refresh();
   }    
  if( strcmp(buf,"2")==0 ){
 dixin[back_line][back_col]=dixinbackup[back_line][back_col];
 dixin[forward_line+1][forward_col-1]='!';
 back_line=forward_line;back_col=forward_col;
 forward_col=forward_col-1;forward_line=forward_line+1;
     screen_refresh();
  }    
  if( strcmp(buf,"3")==0 ){
 dixin[back_line][back_col]=dixinbackup[back_line][back_col];
 dixin[forward_line+1][forward_col]='!';
 back_line=forward_line;back_col=forward_col;
 forward_line=forward_line+1;
     screen_refresh();
}    
  if( strcmp(buf,"4")==0 ){
 dixin[back_line][back_col]=dixinbackup[back_line][back_col];
 dixin[forward_line+1][forward_col+1]='!';
 back_line=forward_line;back_col=forward_col;
 forward_col=forward_col+1;forward_line=forward_line+1;
     screen_refresh();
}    
  if( strcmp(buf,"5")==0 ){
 dixin[back_line][back_col]=dixinbackup[back_line][back_col];
 dixin[forward_line][forward_col+1]='!';
 back_line=forward_line;back_col=forward_col;
 forward_col=forward_col+1;
     screen_refresh();
}    
  if( strcmp(buf,"6")==0 ){
 dixin[back_line][back_col]=dixinbackup[back_line][back_col];
 dixin[forward_line-1][forward_col+1]='!';
 back_line=forward_line;back_col=forward_col;
 forward_col=forward_col+1;forward_line=forward_line-1;
     screen_refresh();
}    
  if( strcmp(buf,"7")==0 ){
 dixin[back_line][back_col]=dixinbackup[back_line][back_col];
 dixin[forward_line-1][forward_col]='!';
 back_line=forward_line;back_col=forward_col;
 forward_line=forward_line-1;
     screen_refresh();
}    
  if( strcmp(buf,"8")==0 ){
 dixin[back_line][back_col]=dixinbackup[back_line][back_col];
 dixin[forward_line-1][forward_col-1]='!';
 back_line=forward_line;back_col=forward_col;
 forward_col=forward_col-1;forward_line=forward_line-1;
     screen_refresh();
}    
  if( strcmp(buf,"9")==0 ){
  break;
         }    
//back_line=3;back_col=2;forward_line=4;forward_col=2;
      


     }
    flag=1;
   }
  if( strcmp(buf,"a")==0 ){flag=1;}
  if( strcmp(buf,"b")==0 ){flag=0;}
  if( strcmp(buf,"c")==0 ){
              memset(buf,0,256);  
              sprintf(buf,"前轮行为%d,前轮列为%d\n",forward_line,forward_col);
              
              send(sockfd,buf,strlen(buf),0); }  
  if( strcmp(buf,"e")==0 ){  break;  }
  if( strcmp(buf,"f")==0 ){  
              memset(buf,0,30);  
              sprintf(buf,"剩余步数%d\n",bushu-k);
              send(sockfd,buf,strlen(buf),0);
             }
//sprintf
   }
  close(sockfd);
  pthread_exit(0);
}

int main(int argc,char ** argv){

back_line=3;back_col=2;forward_line=4;forward_col=2;


panduanxunwen=0;
 
             //char dixin[50][15];
int i,j;
printf("输入步数:\n");
scanf("%d",&bushu);
     
pthread_create(&transcommand,NULL,(void *)xunwenserver,NULL);
 for(k=1;k<=bushu;k++)
 {
 sleep(1);  

     
  if(flag==1){      
                    forward_one_step();
                    screen_refresh();
             }//endif
  else{  sleep(1);    }

 }

}

